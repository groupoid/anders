module induction where
import library/sigma

option girard true

-- Steve Awodey, Nicola Gambino, Kristina Sojakova
-- Inductive Types in Homotopy Type Theory
-- https://arxiv.org/pdf/1201.3898.pdf

-- Jasper Hugunin
-- Why not W?
-- https://jashug.github.io/papers/whynotw.pdf

-- Primitives: 0, 1, 2, W

def 0-ind (C: ğŸ â†’ U) (z: ğŸ) : C z := indâ‚€ (C z) z
def 1-ind (C: ğŸ â†’ U) (x: C â˜…) (z: ğŸ) : C z := indâ‚ C x z
def 2-ind (C: ğŸ â†’ U) (x: C 0â‚‚) (y: C 1â‚‚) (z: ğŸ) : C z := indâ‚‚ C x y z
def W-ind (A : U) (B : A â†’ U) (C : (W (x : A), B x) â†’ U)
    (g : Î  (x : A) (f : B x â†’ (W (x : A), B x)), (Î  (b : B x), C (f b)) â†’ C (sup A B x f))
    (a : A) (f : B a â†’ (W (x : A), B x)) (b : B a) : C (f b) := indáµ‚ A B C g (f b)

def indáµ‚-Î² (A : U) (B : A â†’ U) (C : (W (x : A), B x) â†’ U)
    (g : Î  (x : A) (f : B x â†’ (W (x : A), B x)), (Î  (b : B x), C (f b)) â†’ C (sup A B x f))
    (a : A) (f : B a â†’ (W (x : A), B x))
  : PathP (<_> C (sup A B a f)) (indáµ‚ A B C g (sup A B a f)) (g a f (Î» (b : B a), indáµ‚ A B C g (f b)))
 := <_> g a f (Î» (b : B a), indáµ‚ A B C g (f b))

def trans-W (A : I â†’ U) (B : Î  (i : I), A i â†’ U) (a : A 0) (f : B 0 a â†’ (W (x : A 0), B 0 x)) : W (x : A 1), B 1 x :=
sup (A 1) (B 1) (transp (<i> A i) 0 a) (transp (<i> B i (transFill (A 0) (A 1) (<j> A j) a @ i) â†’ (W (x : A i), B i x)) 0 f)

def trans-Wâ€² (A : I â†’ U) (B : Î  (i : I), A i â†’ U) (a : A 0) (f : B 0 a â†’ (W (x : A 0), B 0 x)) : W (x : A 1), B 1 x :=
transp (<i> W (x : A i), B i x) 0 (sup (A 0) (B 0) a f)

def trans-W-is-correct (A : I â†’ U) (B : Î  (i : I), A i â†’ U) (a : A 0) (f : B 0 a â†’ (W (x : A 0), B 0 x)) :
   Path (W (x : A 1), B 1 x) (trans-W A B a f) (trans-Wâ€² A B a f) :=
<_> trans-W A B a f

--def hcomp-W (A : U) (B : A â†’ U) (r : I) (a : I â†’ Partial A r)
--   (f : Î  (i : I), PartialP [(r = 1) â†’ B (a i 1=1) â†’ (W (x : A), B x)] r)
--   (aâ‚€ : A[r â†¦ a 0]) (fâ‚€ : (B (ouc aâ‚€) â†’ (W (x : A), B x))[r â†¦ f 0]) : W (x : A), B x :=
--sup A B (hcomp A r a (ouc aâ‚€)) (hcomp (B (hcomp A r a (ouc aâ‚€)) â†’ (W (x : A), B x)) r
--   (Î» (i : I), [(r = 1) â†’ Î» (b : B (a 1 1=1)), (f i 1=1) (transp (<j> B (a (-j âˆ¨ i) 1=1)) 0 b)]) ?)

def hcomp-Wâ€² (A : U) (B : A â†’ U) (r : I) (a : I â†’ Partial A r)
   (f : Î  (i : I), PartialP [(r = 1) â†’ B (a i 1=1) â†’ (W (x : A), B x)] r)
   (aâ‚€ : A[r â†¦ a 0]) (fâ‚€ : (B (ouc aâ‚€) â†’ (W (x : A), B x))[r â†¦ f 0]) : W (x : A), B x :=
hcomp (W (x : A), B x) r (Î» (i : I), [(r = 1) â†’ sup A B (a i 1=1) (f i 1=1)]) (sup A B (ouc aâ‚€) (ouc fâ‚€))

-- Derivable Induction: N, +, Maybe, Fin, Vec, 3, 4

def â„• := W (x : ğŸ), indâ‚‚ (Î» (_ : ğŸ), U) ğŸ ğŸ x
def â„•-ctor := indâ‚‚ (Î» (_ : ğŸ), U) ğŸ ğŸ
def zero : â„• := sup ğŸ â„•-ctor 0â‚‚ (indâ‚€ â„•)
def succ (n : â„•) : â„• := sup ğŸ â„•-ctor 1â‚‚ (Î» (x : ğŸ), n)

def ğŸâŸ¶â„• (C : â„• â†’ U) (f : ğŸ â†’ â„•) : C zero â†’ C (sup ğŸ â„•-ctor 0â‚‚ f)
 := transp (<i> C (sup ğŸ â„•-ctor 0â‚‚ (Î» (x : ğŸ), indâ‚€ (PathP (<_> â„•) (indâ‚€ â„• x) (f x)) x @ i))) 0

def ğŸâŸ¶â„• (C : â„• â†’ U) (f : ğŸ â†’ â„•) : C (succ (f â˜…)) â†’ C (sup ğŸ â„•-ctor 1â‚‚ f)
 := transp (<i> C (sup ğŸ â„•-ctor 1â‚‚ (Î» (x : ğŸ), indâ‚ (Î» (y : ğŸ), PathP (<_> â„•) (f â˜…) (f y)) (<_> f â˜…) x @ i))) 0

def â„•-ind (C : â„• â†’ U) (z : C zero) (s : Î  (n : â„•), C n â†’ C (succ n)) : Î  (n : â„•), C n
 := indáµ‚ ğŸ â„•-ctor C
    (indâ‚‚ (Î» (x : ğŸ), Î  (f : â„•-ctor x â†’ â„•), (Î  (b : â„•-ctor x), C (f b)) â†’ C (sup ğŸ â„•-ctor x f))
          (Î» (f : ğŸ â†’ â„•) (g : Î  (x : ğŸ), C (f x)), ğŸâŸ¶â„• C f z)
          (Î» (f : ğŸ â†’ â„•) (g : Î  (x : ğŸ), C (f x)), ğŸâŸ¶â„• C f (s (f â˜…) (g â˜…))))

def â„•-rec (C : U) (z : C) (s : â„• â†’ C â†’ C) : â„• â†’ C := â„•-ind (Î» (_ : â„•), C) z s
def â„•-iter (C : U) (z : C) (s : C â†’ C) : â„• â†’ C := â„•-rec C z (Î» (_ : â„•), s)
def â„•-case (C : U) (z s : C) : â„• â†’ C := â„•-iter C z (Î» (_ : C), s)

def plus : â„• â†’ â„• â†’ â„• := â„•-iter (â„• â†’ â„•) (idfun â„•) (âˆ˜ â„• â„• â„• succ)
def mult : â„• â†’ â„• â†’ â„• := â„•-rec (â„• â†’ â„•) (\(_: â„•), zero) (\(_: â„•) (x: â„• â†’ â„•) (m: â„•), plus m (x m))

def one : â„• := succ zero
def two : â„• := succ one
def three : â„• := succ two
def 5 : â„• := plus two three
def 10 : â„• := mult 5 two
def 55 : â„• := plus (mult 5 10) 5

def + (A B: U) : U := Î£ (x : ğŸ), indâ‚‚ (Î» (_ : ğŸ), U) A B x
def inl (A B : U) (a : A) : + A B := (0â‚‚, a)
def inr (A B : U) (b : B) : + A B := (1â‚‚, b)
def +-ind (A B : U) (C : + A B â†’ U) (f : Î  (x : A), C (inl A B x)) (g : Î  (y : B), C (inr A B y)) (w : + A B) : C w
 := indâ‚‚ (Î» (x : ğŸ), Î  (u : indâ‚‚ (Î» (_ : ğŸ), U) A B x), C (x, u)) f g w.1 w.2

def maybe (A : U) : U := + ğŸ A
def nothing (A : U) : maybe A := (0â‚‚, â˜…)
def just (A : U) (a : A) : maybe A := (1â‚‚, a)
def maybe-ind (A : U) (P: maybe A -> U) (n: P (nothing A)) (j: Î  (x: A), P (just A x)) : Î  (a: maybe A), P a
 := +-ind ğŸ A P (indâ‚ (Î» (x : ğŸ), P (0â‚‚, x)) n) j

def Fin : â„• â†’ U := â„•-iter U ğŸ (+ ğŸ)
def fzero (n : â„•) : Fin (succ n) := (0â‚‚, â˜…)
def fsucc (n : â„•) (m : Fin n) : Fin (succ n) := (1â‚‚, m)
def Fin-ind (T : Î  (n : â„•), Fin n â†’ U) (z : Î  (n : â„•), T (succ n) (fzero n))
   (s : Î  (n : â„•) (x : Fin n), T n x â†’ T (succ n) (fsucc n x)) (m : â„•) (x : Fin m) : T m x :=
â„•-ind (Î» (k : â„•), Î  (x : Fin k), T k x) (Î» (x : ğŸ), indâ‚€ (T zero x) x)
   (Î» (k : â„•) (f : Î  (x : Fin k), T k x),
      +-ind ğŸ (Fin k) (T (succ k))
         (indâ‚ (Î» (w : ğŸ), T (succ k) (0â‚‚, w)) (z k))
         (Î» (w : Fin k), s k w (f w))) m x

def Vec (A : U) : â„• â†’ U := â„•-iter U ğŸ (Î» (X : U), A Ã— X)
def vzero (A : U) : Vec A zero := â˜…
def vsucc (A : U) (n : â„•) (head : A) (tail : Vec A n) : Vec A (succ n) := (head, tail)
def Vec-ind (A : U) (T : Î  (n : â„•), Vec A n â†’ U) (z : T zero (vzero A))
   (s : Î  (n : â„•) (x : A) (v : Vec A n), T n v â†’ T (succ n) (vsucc A n x v))
   (m : â„•) : Î  (x : Vec A m), T m x :=
â„•-ind (Î» (k : â„•), Î  (x : Vec A k), T k x) (indâ‚ (T zero) z)
   (Î» (k : â„•) (f : Î  (x : Vec A k), T k x) (y : Vec A (succ k)),
      s k y.1 y.2 (f y.2)) m

def Vec-rec (A B : U) (z : B) (s : Î  (n : â„•), A â†’ Vec A n â†’ B â†’ B) (m : â„•) : Vec A m â†’ B :=
Vec-ind A (Î» (n : â„•) (_ : Vec A n), B) z s m

def Vec-map (A B : U) (f : A â†’ B) (n : â„•) : Vec A n â†’ Vec B n :=
Vec-ind A (Î» (k : â„•) (_ : Vec A k), Vec B k) â˜…
   (Î» (k : â„•) (x : A) (_ : Vec A k), vsucc B k (f x)) n

def ğŸ‘ : U := + ğŸ ğŸ
def 0â‚ƒ : ğŸ‘ := inl ğŸ ğŸ â˜…
def 1â‚ƒ : ğŸ‘ := inr ğŸ ğŸ 0â‚‚
def 2â‚ƒ : ğŸ‘ := inr ğŸ ğŸ 1â‚‚
def indâ‚ƒ (C : ğŸ‘ â†’ U) (câ‚€ : C 0â‚ƒ) (câ‚ : C 1â‚ƒ) (câ‚‚ : C 2â‚ƒ) : Î  (x : ğŸ‘), C x
 := +-ind ğŸ ğŸ C (indâ‚ (Î» (x : ğŸ), C (0â‚‚, x)) câ‚€) (indâ‚‚ (Î» (x : ğŸ), C (1â‚‚, x)) câ‚ câ‚‚)

def ğŸ’ : U := + ğŸ ğŸ
def 0â‚„ : ğŸ’ := inl ğŸ ğŸ 0â‚‚
def 1â‚„ : ğŸ’ := inl ğŸ ğŸ 1â‚‚
def 2â‚„ : ğŸ’ := inr ğŸ ğŸ 0â‚‚
def 3â‚„ : ğŸ’ := inr ğŸ ğŸ 1â‚‚
def indâ‚„ (C : ğŸ’ â†’ U) (câ‚€ : C 0â‚„) (câ‚ : C 1â‚„) (câ‚‚ : C 2â‚„) (câ‚ƒ : C 3â‚„) : Î  (x : ğŸ’), C x
 := +-ind ğŸ ğŸ C (indâ‚‚ (Î» (x : ğŸ), C (0â‚‚, x)) câ‚€ câ‚) (indâ‚‚ (Î» (x : ğŸ), C (1â‚‚, x)) câ‚‚ câ‚ƒ)

def ğŸ“ : U := + ğŸ ğŸ‘
def 0â‚… : ğŸ“ := inl ğŸ ğŸ‘ 0â‚‚
def 1â‚… : ğŸ“ := inl ğŸ ğŸ‘ 1â‚‚
def 2â‚… : ğŸ“ := inr ğŸ ğŸ‘ 0â‚ƒ
def 3â‚… : ğŸ“ := inr ğŸ ğŸ‘ 1â‚ƒ
def 4â‚… : ğŸ“ := inr ğŸ ğŸ‘ 2â‚ƒ
def indâ‚… (C : ğŸ“ â†’ U) (câ‚€ : C 0â‚…) (câ‚ : C 1â‚…) (câ‚‚ : C 2â‚…) (câ‚ƒ : C 3â‚…) (câ‚„ : C 4â‚…) : Î  (x : ğŸ“), C x
 := +-ind ğŸ ğŸ‘ C (indâ‚‚ (Î» (x : ğŸ), C (0â‚‚, x)) câ‚€ câ‚) (indâ‚ƒ (Î» (x : ğŸ‘), C (1â‚‚, x)) câ‚‚ câ‚ƒ câ‚„)

def ğŸ” : U := + ğŸ‘ ğŸ‘
def 0â‚† : ğŸ” := inl ğŸ‘ ğŸ‘ 0â‚ƒ
def 1â‚† : ğŸ” := inl ğŸ‘ ğŸ‘ 1â‚ƒ
def 2â‚† : ğŸ” := inl ğŸ‘ ğŸ‘ 2â‚ƒ
def 3â‚† : ğŸ” := inr ğŸ‘ ğŸ‘ 0â‚ƒ
def 4â‚† : ğŸ” := inr ğŸ‘ ğŸ‘ 1â‚ƒ
def 5â‚† : ğŸ” := inr ğŸ‘ ğŸ‘ 2â‚ƒ
def indâ‚† (C : ğŸ” â†’ U) (câ‚€ : C 0â‚†) (câ‚ : C 1â‚†) (câ‚‚ : C 2â‚†) (câ‚ƒ : C 3â‚†) (câ‚„ : C 4â‚†) (câ‚… : C 5â‚†) : Î  (x : ğŸ”), C x
 := +-ind ğŸ‘ ğŸ‘ C (indâ‚ƒ (Î» (x : ğŸ‘), C (0â‚‚, x)) câ‚€ câ‚ câ‚‚) (indâ‚ƒ (Î» (x : ğŸ‘), C (1â‚‚, x)) câ‚ƒ câ‚„ câ‚…)

def ğŸ• : U := + ğŸ‘ ğŸ’
def 0â‚‡ : ğŸ• := inl ğŸ‘ ğŸ’ 0â‚ƒ
def 1â‚‡ : ğŸ• := inl ğŸ‘ ğŸ’ 1â‚ƒ
def 2â‚‡ : ğŸ• := inl ğŸ‘ ğŸ’ 2â‚ƒ
def 3â‚‡ : ğŸ• := inr ğŸ‘ ğŸ’ 0â‚„
def 4â‚‡ : ğŸ• := inr ğŸ‘ ğŸ’ 1â‚„
def 5â‚‡ : ğŸ• := inr ğŸ‘ ğŸ’ 2â‚„
def 6â‚‡ : ğŸ• := inr ğŸ‘ ğŸ’ 3â‚„
def indâ‚‡ (C : ğŸ• â†’ U) (câ‚€ : C 0â‚‡) (câ‚ : C 1â‚‡) (câ‚‚ : C 2â‚‡) (câ‚ƒ : C 3â‚‡) (câ‚„ : C 4â‚‡) (câ‚… : C 5â‚‡) (câ‚† : C 6â‚‡) : Î  (x : ğŸ•), C x
 := +-ind ğŸ‘ ğŸ’ C (indâ‚ƒ (Î» (x : ğŸ‘), C (0â‚‚, x)) câ‚€ câ‚ câ‚‚) (indâ‚„ (Î» (x : ğŸ’), C (1â‚‚, x)) câ‚ƒ câ‚„ câ‚… câ‚†)