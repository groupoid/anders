{- Homotopy Pullback: https://anders.groupoid.space/mathematics/homotopy/pullback/

   HoTT 2.15

   Copyright (c) Groupoid Infinity, 2014-2022. -}

module pullback where
import lib/foundations/univalent/path
import lib/foundations/univalent/equiv

--       zâ‚‚
--    Z â€•â€•â€•â€•â†’ B
--    |       |
-- zâ‚ |  pb   | g
--    â†“       â†“
--    A â€•â€•â€•â€•â†’ C
--        f

def pullback (A B C : U) (f : A â†’ C) (g : B â†’ C) : U := Î£ (a : A) (b : B), Path C (f a) (g b)
def kernel  (A B : U) (f : A â†’ B) : U := pullback A A B f f
def hofiber (A B : U) (f : A â†’ B) (y : B): U := pullback A ğŸ B f (Î» (x : ğŸ), y)

def pbâ‚ (A B C : U) (f : A â†’ C) (g : B â†’ C) : pullback A B C f g â†’ A := Î» (x : pullback A B C f g), x.1
def pbâ‚‚ (A B C : U) (f : A â†’ C) (g : B â†’ C) : pullback A B C f g â†’ B := Î» (x : pullback A B C f g), x.2.1
def pbâ‚ƒ (A B C : U) (f : A â†’ C) (g : B â†’ C) : Î  (x : pullback A B C f g), Path C (f x.1) (g x.2.1) := Î» (x : pullback A B C f g), x.2.2

def induced (Z A B C : U) (f : A â†’ C) (g : B â†’ C) (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B)
  (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)) : Z â†’ pullback A B C f g
 := Î» (z : Z), (zâ‚ z, zâ‚‚ z, h z)

def pullbackSq (Z A B C : U) (f : A â†’ C) (g : B â†’ C) (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B): U
 := Î£ (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)), isEquiv Z (pullback A B C f g) (induced Z A B C f g zâ‚ zâ‚‚ h)

def isPullbackSq (Z A B C : U) (f : A â†’ C) (g : B â†’ C) (zâ‚ : Z â†’ A) (zâ‚‚ : Z â†’ B) (h : Î  (z : Z), Path C ((âˆ˜ Z A C f zâ‚) z) (((âˆ˜ Z B C g zâ‚‚)) z)) : U
 := isEquiv Z (pullback A B C f g) (induced Z A B C f g zâ‚ zâ‚‚ h)

-- Exercise 2.11. Prove that the pullback P :â‰¡ A x_C B defined in (2.15.11) is the corner of a pullback square.
axiom completePullback (A B C : U) (f : A â†’ C) (g : B â†’ C) : pullbackSq (pullback A B C f g) A B C f g (pbâ‚ A B C f g) (pbâ‚‚ A B C f g)

def fiberPullback (A B : U) (f : A â†’ B) (y : B)
  : pullbackSq (hofiber A B f y) A ğŸ B f (Î» (x : ğŸ), y) (pbâ‚ A ğŸ B f (Î» (x : ğŸ), y)) (pbâ‚‚ A ğŸ B f (Î» (x : ğŸ), y))
 := completePullback A ğŸ B f (Î» (x : ğŸ), y)
