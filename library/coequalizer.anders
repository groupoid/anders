{- Homotopy Type Theory:
   - Coequalizer and Hubs/Spokes as primitives.
   - SÂ¹ sphere and ğ‘›-sphere.
   - Pushout.
   - Suspension.
   - ğ‘›-Truncation.

   HoTT 6.8 Pushouts
   HoTT 6.10 Quotients
   HoTT 6.7 Hubs and Spokes
   HoTT 6.9 Truncations
   
   Copyright (c) Groupoid Infinity, 2014-2022. -}
   
module coequalizer where
import library/induction
import library/algebra

-- [1]. Nicolai Kraus, Jakob von Raumer.
-- Path spaces of higher inductive types in homotopy type theory.
-- http://pure-oai.bham.ac.uk/ws/files/84880431/Path_Spaces.pdf

-- [Bauer, Gross, Lumsdaine, Shulman, Sozeau, Spitters] Coq HoTT
-- The HoTT Library: A formalization of homotopy type theory in Coq
-- https://arxiv.org/pdf/1610.04591.pdf

{- Coequalizer Primitive -}

axiom coequ (A B : U) (f g : A â†’ B) : U
axiom Î¹ (A B : U) (f g : A â†’ B) : B â†’ coequ A B f g
axiom resp (A B : U) (f g : A â†’ B) (x : A) : Path (coequ A B f g) (Î¹ A B f g (f x)) (Î¹ A B f g (g x))
axiom coequ-ind (A B : U) (f g : A â†’ B) (X : coequ A B f g â†’ U) (i : Î  (b : B), X (Î¹ A B f g b))
    : (Î  (x : A), PathP (<i> X (resp A B f g x @ i)) (i (f x)) (i (g x))) â†’ (Î  (z : coequ A B f g), X z)
axiom coequ-ind-Î²â‚ (A B : U) (f g : A â†’ B) (X : coequ A B f g â†’ U) (i : Î  (b : B), X (Î¹ A B f g b))
      (Ï : Î  (x : A), PathP (<i> X (resp A B f g x @ i)) (i (f x)) (i (g x))) (b : B)
    : Path (X (Î¹ A B f g b)) (coequ-ind A B f g X i Ï (Î¹ A B f g b)) (i b)

-- coequ-ind-Î²â‚ need to be definitional to write this properly (i.e. without transp)
{-
axiom coequ-ind-Î²â‚‚ (A B : U) (f g : A â†’ B) (X : coequ A B f g â†’ U) (i : Î  (b : B), X (Î¹ A B f g b))
  (Ï : Î  (x : A), PathP (<i> X (resp A B f g x @ i)) (i (f x)) (i (g x))) (x : A) :
  Path (PathP (<j> X (resp A B f g x @ j)) (i (f x)) (i (g x)))
       (<j> coequ-ind A B f g X i Ï (resp A B f g x @ j)) (Ï x)
-}

-- [Caglayan] 2014

def pushout (A B C : U) (f : C â†’ A) (g : C â†’ B) : U := coequ C (+ A B) (âˆ˜ C A (+ A B) (inl A B) f) (âˆ˜ C B (+ A B) (inr A B) g)
def poâ‚ (A B C: U) (f: C â†’ A) (g: C â†’ B) (a: A) : pushout A B C f g := Î¹ C (+ A B) (âˆ˜ C A (+ A B) (inl A B) f) (âˆ˜ C B (+ A B) (inr A B) g) (inl A B a)
def poâ‚‚ (A B C: U) (f: C â†’ A) (g: C â†’ B) (b: B) : pushout A B C f g := Î¹ C (+ A B) (âˆ˜ C A (+ A B) (inl A B) f) (âˆ˜ C B (+ A B) (inr A B) g) (inr A B b)
def poâ‚ƒ (A B C: U) (f: C â†’ A) (g: C â†’ B) (c: C) : Path (pushout A B C f g) (poâ‚ A B C f g (f c)) (poâ‚‚ A B C f g (g c))
 := resp C (+ A B) (âˆ˜ C A (+ A B) (inl A B) f) (âˆ˜ C B (+ A B) (inr A B) g) c

-- [Shulman] 2015

def SÂ¹ : U := coequ ğŸ ğŸ (id ğŸ) (id ğŸ)
def base : SÂ¹ := Î¹ ğŸ ğŸ (id ğŸ) (id ğŸ) â˜…
def loop : Path SÂ¹ base base := resp ğŸ ğŸ (id ğŸ) (id ğŸ) â˜… 

-- [Caglayan] 2018

def ğšº (A: U) : U := pushout ğŸ ğŸ A (Î» (_: A), â˜…) (Î» (_: A), â˜…)
def ğœâ‚ (A: U): ğšº A   := poâ‚ ğŸ ğŸ A (Î» (_: A), â˜…) (Î» (_: A), â˜…) â˜…
def ğœâ‚‚ (A: U): ğšº A   := poâ‚‚ ğŸ ğŸ A (Î» (_: A), â˜…) (Î» (_: A), â˜…) â˜…
def ğœâ‚ƒ (A: U) (a: A) : Path (ğšº A) (ğœâ‚ A) (ğœâ‚‚ A) := poâ‚ƒ ğŸ ğŸ A (Î» (_: A), â˜…) (Î» (_: A), â˜…) a

def sphere : â„• â†’ U := â„•-iter U ğŸ ğšº

def full (A : U) (R : A â†’ A â†’ U) := Î£ (x y : A), R x y
def quot (A : U) (R : A â†’ A â†’ U) := coequ (full A R) A (Î» (w : full A R), w.1) (Î» (w : full A R), w.2.1)
def quot-elem (A : U) (R : A â†’ A â†’ U) : A â†’ quot A R := Î¹ (full A R) A (Î» (w : full A R), w.1) (Î» (w : full A R), w.2.1)
def quot-glue (A : U) (R : A â†’ A â†’ U) (x y : A) (Ï : R x y)
  : Path (quot A R) (quot-elem A R x) (quot-elem A R y)
 := resp (full A R) A (Î» (w : full A R), w.1) (Î» (w : full A R), w.2.1) (x, y, Ï)

{- Hub and Spoke Primitive -}

axiom hs (S A : U) : U
axiom center (S A : U) (x : A) : hs S A
axiom hub (S A : U) (f : S â†’ hs S A) : hs S A
axiom spoke (S A : U) (f : S â†’ hs S A) (s : S) : Path (hs S A) (hub S A f) (f s)
axiom hubâ‚‹â‚‚ (S A : U) (x y : A) (p : S â†’ Path A x y) : Path (hs S A) (center S A x) (center S A y)
axiom spokeâ‚‹â‚‚ (S A : U) (x y : A) (p : S â†’ Path A x y) (s : S) : Path (hs S A) (hubâ‚‹â‚‚ S A x y p @ 0) (center S A (p s @ 1))

axiom isNull (S A : U) : U
axiom hs-ind (S A : U) (B : hs S A â†’ U) (nB : Î  (x : hs S A), isNull S (B x))
      (nC : Î  (a : A), B (center S A a)) (x : hs S A) : B x

{- Generic â„•-indexed Truncations -}

def trunc (A : U) (n : â„•) : U := hs (sphere n) A
def truncâ‚ (A : U) (n : â„•) (x : A) : trunc A n := center (sphere n) A x
def truncâ‚‚ (A : U) (n : â„•) (f : sphere n â†’ trunc A n) : trunc A n := hub (sphere n) A f
def truncâ‚ƒ (A : U) (n : â„•) (f : sphere n â†’ trunc A n) (s : sphere n)
  : Path (trunc A n) (hub (sphere n) A f) (f s) := spoke (sphere n) A f s

{- Trancation Instances for â‚‹â‚,â‚€,â‚ truncation levels -}

def â€–_â€–â‚‹â‚ (A : U) := trunc A zero -- Propositional Truncation ||A|| or |A|â‚‹â‚
def â€–_â€–â‚€  (A : U) := trunc A one  -- Set Truncation |A|â‚€
def â€–_â€–â‚  (A : U) := trunc A two  -- Groupoid Truncation |A|â‚
def â€–_â€– (A : U) : â„• â†’ U := trunc A

-- [van Doorn] 2016 2-quotient

axiom 2-quot (A : U) (R : A â†’ A â†’ U) (x y : A) (Q : R x y) : U

def discreteTopology (G : abgroup) : U := group
def ğšºâ‚“ (A: U) : â„• â†’ U := â„•-iter U A ğšº

def Kâ¦…Gâ€š1â¦† (G : group) : U
 := â€–_â€–â‚ (2-quot ğŸ (Î» (x y : ğŸ), group) â˜… â˜… G)
 
def Kâ¦…Gâ€šnâ¦† (G : abgroup) (n: â„•) : U
 := â„•-iter U (discreteTopology G) (Î» (_: U), â€–_â€– (ğšºâ‚“ (Kâ¦…Gâ€š1â¦† (G.X,G.2.g)) n) n) n

