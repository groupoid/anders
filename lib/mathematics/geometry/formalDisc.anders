{- The modality of shape infinitesimal in cohesive infinity topos.
   - \Im modality type.

   Felix Cherubini PhD

   https://arxiv.org/pdf/1806.05966.pdf

   Copyright (c) Groupoid Infinity, 2014-2022. -}

module formalDisc where
import lib/foundations/univalent/path
import lib/foundations/univalent/iso
import lib/foundations/modal/infinitesimal

def ~ (X : U) (a xâ€² : X) : U := Path (â„‘ X) (Î¹ X a) (Î¹ X xâ€²)
def ğ”» (X : U) (a : X) : U := Î£ (xâ€² : X), ~ X a xâ€²
def unitDisc (X : U) (x : â„‘ X) : U := Î£ (xâ€² : X), Path (â„‘ X) x (Î¹ X xâ€²)
def starDisc (X : U) (x : X) : ğ”» X x := (x, idp (â„‘ X) (Î¹ X x))
def Tâˆ (A : U) : U := Î£ (a : A), ğ”» A a
def inf-prox-ap (X Y : U) (f : X â†’ Y) (x xâ€² : X) (p : ~ X x xâ€²) : ~ Y (f x) (f xâ€²) := <i> â„‘-app X Y f (p @ i)
def d (X Y : U) (f : X â†’ Y) (x : X) (Îµ : ğ”» X x) : ğ”» Y (f x) := (f Îµ.1, inf-prox-ap X Y f x Îµ.1 Îµ.2)
def Tâˆ-map (X Y : U) (f : X â†’ Y) (Ï„ : Tâˆ X) : Tâˆ Y := (f Ï„.1, d X Y f Ï„.1 Ï„.2)
def is-homogeneous (A : U) := Î£ (e : A) (t : A â†’ equiv A A), Î  (x : A), Path A ((t x).1 e) x

lemma inf-prox-comp (X Y Z : U) (f : Y â†’ Z) (g : X â†’ Y) (x xâ€² : X) (p : ~ X x xâ€²)
    : Path (~ Z (f (g x)) (f (g xâ€²)))
           (inf-prox-ap X Z (âˆ˜ X Y Z f g) x xâ€² p)
           (inf-prox-ap Y Z f (g x) (g xâ€²) (inf-prox-ap X Y g x xâ€² p))
   := <i j> â„‘-app-comp X Y Z f g (p @ j) @ i

theorem diff-comp (A B C : U) (f : A â†’ B) (g : B â†’ C) (x : A)
      : Path ((ğ”» A x â†’ ğ”» C ((âˆ˜ A B C g f) x))) (d A C (âˆ˜ A B C g f) x)
             (âˆ˜ (ğ”» A x) (ğ”» B (f x)) (ğ”» C (g (f x))) (d B C g (f x)) (d A B f x))
     := <i> Î» (Îµ : ğ”» A x), (g (f Îµ.1), inf-prox-comp A B C g f x Îµ.1 Îµ.2 @ i)

def âˆ-unital-magma (X : U) := Î£ (e : X) (Î¼ : X â†’ X â†’ X), Î  (x : X), Path X (Î¼ e x) x Ã— Path X (Î¼ x e) x
def is-left-invertible  (X : U) (M : âˆ-unital-magma X) := Î  (a : X), isEquiv X X (Î» (x : X), M.Î¼ x a)
def is-right-invertible (X : U) (M : âˆ-unital-magma X) := Î  (a : X), isEquiv X X (M.Î¼ a)

def H-space   := Î£ (X : U), âˆ-unital-magma X
def LIH-space := Î£ (X : U) (M : âˆ-unital-magma X), is-left-invertible X M
def RIH-space := Î£ (X : U) (M : âˆ-unital-magma X), is-right-invertible X M
